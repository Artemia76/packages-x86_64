description="The GRUB package contains the GRand Unified Bootloader."
url="http://www.gnu.org/software/grub/"

packager="tnut <tnut@nutyx.org>"
contributors="Pierre B, Schrodinger72"

name=grub
version=2.04
release=3

dejavu_version=2.37

makedepends=(automake m4 bison flex gettext texinfo python
             xz efibootmgr efivar freetype lvm2)

source=(http://downloads.sourceforge.net/dejavu/dejavu-fonts-ttf-${dejavu_version}.tar.bz2
        https://ftp.gnu.org/gnu/grub/grub-$version.tar.xz
	grub.cfg)

PKGMK_GROUPS=(man)

unset MAKEFLAGS

prepare() {
mv dejavu-fonts-ttf-${dejavu_version}/ttf/Deja* \
grub-$version
}

build() {
  cp -a grub-$version grub-efi-$version

	cd grub-$version
	./configure --prefix=/usr \
		--sysconfdir=/etc       \
		--sbindir=/sbin        \
		--infodir=/usr/share/info \
                --with-platform=pc \
                --disable-efiemu \
                --disable-werror

	make
	make DESTDIR=$PKG install

  cd ../grub-efi-$version
	./configure --prefix=/usr \
		--sysconfdir=/etc       \
		--sbindir=/sbin        \
		--disable-efiemu \
		--infodir=/usr/share/info \
                --with-platform=efi \
		--disable-werror
	make
	mkdir $SRC/dest
	make DESTDIR=$SRC/dest install
        install -d $PKG/boot/grub
	install -Dm644 ../grub.cfg \
	$PKG/boot/grub/grub.cfg.exemple

	cp -r $SRC/dest/usr/lib/grub/x86_64-efi $PKG/usr/lib/grub/
}
