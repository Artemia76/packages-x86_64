# Depends on: cmake rustc git openssl

description="Cargo is the Package Manager for Rust"
url=" https://github.com/rust-lang/cargo/"
contributors="Pierre B"
packager="tnut <tnut@nutyx.org>"

PKGMK_KEEP_SOURCES="no"
PKGMK_IGNORE_UNPACK="yes"

name=cargo
version=0.17.0
release=1

source=(https://github.com/rust-lang/cargo/archive/$version.tar.gz
        https://static.rust-lang.org/dist/cargo-0.16.0-${PKGMK_ARCH}-unknown-linux-gnu.tar.gz
	http://anduin.linuxfromscratch.org/BLFS/rust/rust-installer-20161004.tar.xz)

build() {

  tar xf $version.tar.gz
  cd $name-$version

  tar -xf ../rust-installer-20161004.tar.xz \
    --strip-components=1 --directory src/rust-installer

  case $PKGMK_ARCH in
	x86_64) tar -xf ../cargo-0.16.0-x86_64-unknown-linux-gnu.tar.gz
	;;
	i686) tar -xf ../cargo-0.16.0-i686-unknown-linux-gnu.tar.gz
	;;
  esac

 
  ./configure --prefix=/usr      \
              --sysconfdir=/etc  \
              --docdir=/usr/share/doc/$name-$version \
              --cargo=./cargo-nightly*/cargo/bin/cargo 
  make
  make DESTDIR=$PKG install

  
  install -d $PKG/etc/bash_completions.d
  mv $PKG/usr/etc/bash_completion.d/cargo \
     $PKG/etc/bash_completions.d

  # In comflict with rust
  for FILE in components install.log rust-installer-version uninstall.sh
  do
    rm $PKG/usr/lib/rustlib/$FILE
  done
} 
