# Description: Lightweight X11 Display Manager based on Gtk
# Url: http://wiki.lxde.org/en/LXDM
# Maintainer: dgod dot osa at gmail dot com
# Packager: tnut at nutyx dot org
# Depends on: xorg-libxinerama xorg-libxrandr xorg-libxcursor xorg-libxdamage gtk consolekit
run=(consolekit)

name=lxdm
version=0.5.0
release=1

source=(http://downloads.sourceforge.net/$name/$name-$version.tar.xz
        http://downloads.nutyx.org/files/patchs/$name/lxdm-industrial-01.tar.gz
        http://downloads.nutyx.org/FondsEcrans/140203075501444240.png)

#http://downloads.nutyx.org/files/icones-sekong-03.tar.gz

build() {
        cd $name-$version
        ./configure --sysconfdir=/etc \
                --prefix=/usr \
                --libexecdir=/usr/lib/lxdm
        make
  
        make DESTDIR=$PKG install


        mkdir -p $PKG/var/run/lxdm
        mkdir -p $PKG/var/lib/lxdm

        sed -i -e "s/local\/libexec/lib\/lxdm/" $PKG/etc/lxdm/lxdm.conf

        mkdir -p $PKG/usr/share/backgrounds
        install -m644 $SRC/140203075501444240.png \
        $PKG/usr/share/backgrounds/default.png
        install -m644 $SRC/usr/share/lxdm/themes/Industrial/login.png \
        $PKG/usr/share/lxdm/themes/Industrial/login.png

        cat > $PKG/etc/pam.d/lxdm << "EOF"
#%PAM-1.0
auth            requisite       pam_nologin.so
auth            required        pam_env.so
auth            required        pam_unix.so
account         required        pam_unix.so
session         required        pam_limits.so
session         required        pam_unix.so
password        required        pam_unix.so
-session        optional        pam_loginuid.so
-session        optional        pam_systemd.so
EOF
}
