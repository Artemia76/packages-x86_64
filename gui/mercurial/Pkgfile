# Depends on: python gnupg subversion bzr python-docutils ca-certificates

description="A scalable distributed SCM tool"
url="http://mercurial.selenic.com"
packager="tnut <tnut@nutyx.org>"
contributors="Berlius, Greg"

run=(python2 python2-docutils) 

name=mercurial
version=4.9

source=(https://www.mercurial-scm.org/release/mercurial-$version.tar.gz
mercurial.profile
)
build() {
  cd $name-$version/
  make build

  sed -i '/runrst/s/N)/N)3/' doc/Makefile
  2to3-3.7 -w doc/hgmanpage.py
  make doc
  install -d $PKG/usr/share/man/{man1,man5}
  install -m644 doc/hg.1 $PKG/usr/share/man/man1
  install -m644 doc/{hgrc.5,hgignore.5} $PKG/usr/share/man/man5
  install -m755 contrib/hgk $PKG/usr/bin
  install -m644 -D contrib/zsh_completion $PKG/usr/share/zsh/site-functions/_hg
  install -m644 -D contrib/bash_completion $PKG/usr/share/bash-completion/completions/hg
  install -d $PKG/usr/share/emacs/site-lisp
  install -m644 contrib/{mq.el,mercurial.el} $PKG/usr/share/emacs/site-lisp

  vimpath=$PKG/usr/share/vim/vimfiles
  install -Dm644 contrib/vim/HGAnnotate.vim ${vimpath}/syntax/HGAnnotate.vim

  # set some variables
  install -m755 -d $PKG/etc/profile.d
  install -m755 $SRC/mercurial.profile $PKG/etc/profile.d/mercurial.sh

  # install configuration file
  install -m755 -d $PKG/etc/mercurial
  # install -m644 contrib/sample.hgrc $PKG/etc/mercurial/hgrc

  # FS#38825 - Add certs config to package
  echo -e "\n[web]\ncacerts = /etc/ssl/certs/ca-certificates.crt\n" >> $PKG/etc/mercurial/hgrc

  cd contrib/chg
  make DESTDIR=$PKG PREFIX=/usr install
}
