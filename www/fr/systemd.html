<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
     <link rel="shortcut icon" href="../favicon.ico">
     <link rel="stylesheet" href="../css/nutyx.css" />
     <title>Passer votre NuTyX SystemV en SystemD</title>
 </head>
 <body>
   <table>
     <tr>
      <td>
            <a href=".."><img id="logo" src="../graphics/logo_nutyx_120.png" alt="logo nutyx" /></a>
      </td>
      <td>
       <nav>
        <ul>
            <li><a href=".">Accueil</a></li>
            <li><a href="information.html">Information</a></li>
            <li><a href="documentation.html">Documentation</a></li>
            <li><a href="installation.html">Installation</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="packages.html">Paquets</a></li>
            <li><a href="http://forum.nutyx.org/index.php?board=10.0">Forum</a></li>
            <li><a href="http://github.com/NuTyX">Code</a></li>
        </ul>
       </nav>
      </td>
     </tr>
    </table>
 <hr>
  <h1>Passer votre NuTyX SystemV en NuTyX SystemD</h1>
   <h2>Introduction</h2>
   <p>Passer du système d'initialisation systemV vers systemD sous NuTyX c'est possible</p>
   <p>Il faut savoir que vous passez d'un concept à un autre, en effet:</p>
   <ol>
    <li>L'intégralité des fichiers de configuration change avec comme seules exceptions, les fichiers <b>/etc/resolv.conf</b> et <b>/etc/host</b>.</li>
    <li>L'utilisation de la post-installation de NuTyX est impossible sous systemd. Il faut donc effectuer le changement sur une NuTyX SystemV de base fonctionnelle et complètement configurée (réseau, locale, clavier, heure)</li>
    <li>Le changement doit se faire en chroot cad depuis une NuTyX se trouvant sur une partition différente. Il vous faut donc DEUX NuTyX installées. Une fonctionnelle en systemV et la future version systemD.</li>
    <li>Tous les services faisant parti de vos paquets installés sont obsolètes. Systemd utilise des "unités" de chargement</li>
    <li>Vu le nombre de dépendances réclamées par systemd, le concept des collections <b>base,cli et gui</b> n'ont plus de signification lorsque vous passez sous systemd</li>
   </ol>
   <h2>Activer la collection systemd</h2>
    <p>Pour pouvoir installer systemd il faut commencer par ajouter <u>en première position</u> la collection <b>systemd</b> dans le fichier <b>/etc/cards.conf</b>
    <pre class="output"># For systemd
dir /var/lib/pkg/depot/systemd|http://downloads.nutyx.org

## For enlightenment
...</pre>
    <p>Resynchronisez les informations de dépot:</p>
    <pre class="command"><kbd>cards sync</kbd></pre>
   <h2>Supprimer les paquets de base obsolètes</h2>
    <pre class="command"><kbd>del -a eudev
del -a sysvinit</kbd></pre>
   <h2>Installer systemd</h2>
    <pre class="command"><kbd>cards install systemd</kbd></pre>
   <h2>Ajuster /etc/fstab</h2>
    <p>La partition cible de votre NuTyX systemd n'est pas mentionnée dans le fichier <b>/etc/fstab</b>
    <p>Ajustez <b>sda4</b> et <b>btrfs</b> avec vos réglages</p>
    <pre class="command"><kbd>cat &gt;&gt; /etc/fstab &lt;&lt; "EOF"
/dev/sda4      /            btrfs    defaults            0     0
EOF</kbd></pre>
   <h2>Le réseau</h2>
    <p>le fichier <b>/etc/systemd/network/10-&lt;nom-de-votre-carte-reseau&gt;-dhcp.network</b> se charge du démarrage du réseau dhcp.</p>
    <p>le fichier <b>/etc/systemd/network/10-&lt;nom-de-votre-carte-reseau&gt;-static.network</b> se charge de la mise en place d'une adresse statique pour votre carte réseau.</p>
    <p>Basez-vous sur le fichier <b>etc/sysconfig/ifconfig.&lt;nom-de-votre-carte-reseau&gt;</b> pour connaître le nom exact</p>
    <p>Dans mon exemple, ce sera la carte <b><u>eno1</u></b>.</p>
     <pre class="command"><kbd>mkdir -p /etc/systemd/network</kbd></pre>
     <h3>dhcp</h3>
     <pre class="command"><kbd>cat &gt; /etc/systemd/network/10-eno1-dhcp.network &lt;&lt; "EOF"
[Match]
Name=eno1

[Network]
DHCP=ipv4

[DHCP]
UseDomains=true
EOF</kbd></pre>
    <h3>statique</h3>
     <pre class="command"><kbd>cat &gt; /etc/systemd/network/10-eno1-static.network &lt;&lt; "EOF"
[Match]
Name=eno1

[Network]
Address=192.168.0.2/24
Gateway=192.168.0.1
DNS=192.168.0.1
Domains=<Your Domain Name>
EOF</kbd></pre>
    <p>Le fichier <b>/etc/resolv.conf</b> est le seul fichier de configuration inchangé. Si vous avez choisi la configuration statique, pensez à le mettre à jour. Si votre NuTyX était à l'origine déjà configuré avec une adresse IP statique, il y a grande chance que vous ne devez rien changer au fichier <b>/etc/resolv.conf</b></p> 
    <p>Le fichier <b>/etc/hostname</b> contient le nom de la machine. Basez vous sur la ligne <b>HOSTNAME=&lt;nom-de-la-machine&gt;</b> dans le fichier <b>/etc/sysconfig/network</b>.</p>
    <p>Le nom par défaut est <b>nutyx</b>.</p>
    <pre class="command"><kbd>echo "nutyx" &gt; /etc/hostname</kbd></pre>
   <h2>L'heure</h2>
    <p>Le fichier <b>/etc/adjtime</b> s'occupe du réglage de l'heure. Pour commencer mettez-y:</p>
    <pre class="command"><kbd>cat &gt; /etc/adjtime &lt;&lt; "EOF"
0.0 0 0.0
0
LOCAL
EOF</kbd></pre>
   <h2>Le clavier et de la police en console non graphique</h2>
    <p>Le fichier <b>/etc/vconsole.conf</b> doit contenir un minimum d'info. Basez-vous sur le contenu du fichier <b>/etc/sysconfig/console</b> créé lors de l'installation de votre NuTyX:</p>
    <pre class="command"><kbd>cat &gt; /etc/vconsole.conf &lt;&lt; "EOF"
KEYMAP=fr_CH-latin1
FONT=Lat2-Terminus16
EOF</kbd></pre>
   <h2>La locale du système</h2>
    <p>Le fichier <b>/etc/locale.conf</b> doit contenir un minimum d'info. Basez-vous sur le contenu du fichier <b>/etc/profile.d/i18n.sh</b> créé lors de l'installation de votre NuTyX:</p>
    <pre class="command"><kbd>cat &gt; /etc/locale.conf &lt;&lt; "EOF"
LANG=fr_CH.utf-8
EOF</kbd></pre>
   <h2>Deactiver l'effacement de l'écran (option)</h2>
    <p>Le fichier <b>/etc/systemd/system/getty@tty1.service.d/noclear.conf</b> défini la fonctionnalitée:</p>
    <pre class="command"><kbd>mkdir -p /etc/systemd/system/getty@tty1.service.d
cat &gt; /etc/systemd/system/getty@tty1.service.d/noclear.conf &lt;&lt; "EOF"
[Service]
TTYVTDisallocate=no
EOF</kbd></pre>
   <h2>Faire croire que eudev est installé</h2>
    <p>De nombreux paquets vont réclamer eudev en dépendance, la solution temporaire consiste à faire croire à cards qu'il est installé, faites en root:</p>
    <pre class="command"><kbd>mkdir -p /var/lib/pkg/DB/eudev
echo usr &gt; /var/lib/pkg/DB/eudev/files
echo "Neudev
DEudev
V3.2
r1
B1466968899
ax86_64
cbase" &gt; /var/lib/pkg/DB/eudev/META</kbd></pre>
  <hr>  
   <p class="updated">Dernière mise à jour 31-07-2016 22:22</p>
    <footer>
        <p id="foot">... <img src="../graphics/logo_nutyx_25.png" alt="nutyx petit logo"> ...<br />
        &copy; 2007 - 2016 <a href="http://nutyx.org">NuTyX</a><br /><br />
    <a href="http://www.wtfpl.net/"><img
       src="http://www.wtfpl.net/wp-content/uploads/2012/12/wtfpl-badge-4.png"
       width="80" height="15" alt="WTFPL" /></a></p>
    </footer>
 </body>
</html>
